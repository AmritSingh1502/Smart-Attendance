<!DOCTYPE html>

{% set counter = {
'counter1': 0
} %}

{% macro increment(dct, key, inc=1)%}
{% if dct.update({key: dct[key] + inc}) %} {% endif %}
{% endmacro %}

{% macro reset(dct, key)%}
{% if dct.update({key: 0})%}{% endif %}
{% endmacro%}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='/css/teacher.css') }}">
    <title>Welcome</title>
</head>

<body>

    <div class="text-display">
        <h1>Welcome, </h1>
        <h1>{{ Data.Name }}</h1>
    </div>



<!--    {% for class in Data.Classes %}-->
<!--    <button class="classtablink" onclick="switchClassTab(event,'{{ class.Name }}')">{{class.Name}}</button>-->
<!--    {%endfor%}-->

    {% for class in Data.Classes %}
    <div id="{{ class.Name }}" class="classtabcontent" {% if not loop.first %} style="display:none" {% endif %}>
        {% for subject in class.Attendance %}
<!--        <button onclick="toggleDetainOption()">-->
<!--            Detain-->
<!--        </button>-->
        <h4 align="center"> Number of Classes conducted for {{ subject.Course }}: {{ subject.Classes_conducted|length }}
        </h4>
        <div class="table-wrapper">
            <table class="fl-table">
                <thead>
                    <tr>
                        <th id="fixed_info"> USN </th>
                        <th> Name </th>
                        {% for date in subject.Classes_conducted %}
                        <th> {{ date }} </th>
                        {% endfor %}
                        <th> Number of Classes Attended </th>
                        <th> Percentage</th>
                    </tr>
                </thead>
                {% for stud in subject.StudentsAttendance %}
                <tbody>
                    <tr>
                        {{ reset(counter, 'counter1')}}
                        <td>{{ stud.get("USN")|upper }}</td>
                        <td id={{subject.Course}}{{stud.get("USN")|upper}}>{{ stud.get("Name")|upper }}</td>
                        {% for att in stud.get("Attendance") %}
                        {% if att == 1 %}
                        {{ increment(counter, 'counter1') }}
                        <td id="cell"> <img src="/static/images/tick.png" alt="" height="24px" width="24px"> </td>
                        {% else %}
                        <td> <img src="/static/images/cross.png" alt="" height="24px" width="24px"> </td>
                        {% endif %}
                        {% endfor %}
                        {% set percent = counter.counter1/(subject.Classes_conducted|length) * 100 %}
                        <td> {{ counter.counter1 }}</td>
                        <td>{{ percent|round(2,'common') }}%</td>
                        </tr>
                        {% if percent < 75 %} <script>
                            var row = document.getElementById("{{subject.Course}}{{ stud.get("USN")|upper }}");
                            markDetained(row);
                                function markDetained(rowID){
                            rowID.style.backgroundColor ="red";
                            }
                            </script>
                            {% endif %}

<!--                            <td class="detaincheckbox" style="display:none">-->

<!--                                <input type="checkbox" id="{{subject.Course}}{{ stud.USN|upper }}"-->
<!--                                       value="{{stud.USN|upper}}" onclick="printUSN({{subject.Course}}{{stud.USN|upper}})">-->
<!--                            </td>-->



                </tbody>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</body>

<script>

    function switchClassTab(evt, tab) {
        var i, x, tablinks;

        x = document.getElementsByClassName("classtabcontent");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("classtablink");
        for (i = 0; i < x.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
        }
        document.getElementById(tab).style.display = "block";
    }

    function printUNS(id) {
        var checkbox = document.getElementById(id);

    }

    function toggleDetainOption() {
        var listofstudents = document.getElementsByClassName("detaincheckbox");
        for (i = 0; i < listofstudents.length; i++) {
            listofstudents[i].style.display = "";
        }
    }



</script>



</html>